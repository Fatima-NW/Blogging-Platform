<!--
Displays user's profile page

Features:
- User's name and username
- For profile owners: edit profile, delete account, create post
- Bio + joining date
- All posts by the user
- Filter to search post by title
-->

{% extends "base.html" %}
{% load static %}
{% block title %}{{ profile_user.username }}{% endblock %}

{% block content %}
    <div class="container mt-5 mb-5">
        <div class="card shadow-sm p-4">

            <div class="d-flex align-items-center justify-content-between mb-3">
                <!-- Name -->
                <h1 class="mb-0 me-3">
                    {% if profile_user.get_full_name %}
                        {{ profile_user.get_full_name }}
                    {% else %}
                        <span class="text-muted">Add Name</span>
                    {% endif %}
                </h1>

                <!-- Edit + Delete buttons-->
                {% if user == profile_user %}
                <div class="d-flex gap-2 flex-shrink-0">
                    <a href="{% url 'notifications' %}" class="btn profile-post-btns notif-btn" title="Notifications"><img src="{% static 'img/notification.png' %}" alt="Notifications" class="icon-img"></a>
                    <a href="{% url 'profile_edit' profile_user.username %}" class="btn profile-post-btns edit-btn" title="Edit"><img src="{% static 'img/edit.png' %}" alt="Edit" class="icon-img"></a>
                    <a href="{% url 'profile_delete' %}" class="btn profile-post-btns delete-btn" title="Delete"><img src="{% static 'img/delete.png' %}" alt="Delete" class="icon-img"></a>
                </div>
                {% endif %}
            </div>

            <!-- Username -->
            <p class="text-muted mb-3">@{{ profile_user.username }}</p>

            <!-- User info -->
            <p>{{ profile_user.bio }}</p>
            <p class="text-muted mb-1">Joined {{ profile_user.date_joined|date:"M Y" }}</p>

            <hr>

            <!-- Posts by user + Create post-->
            <div class="d-flex justify-content-between">
                <h3 class="mb-3">All Posts</h3>
                {% if user == profile_user %}
                    <a href="{% url 'post_create' %}" class="btn profile-create-btn mb-3">+ Create New Post</a>
                {% endif %}
            </div>

            <!-- Search form for author's posts -->
            <form method="get" class="mb-4 p-3 bg-light filter">
                <div class="d-flex align-items-center">
                    <input type="text" name="title" class="form-control me-2" placeholder="Search by title" value="{{ request.GET.title }}">
                    <button type="submit" class="btn search-btn me-2" title="Search"><img src="{% static 'img/search.png' %}" alt="Search" class="icon-img"></button>
                    <a href="{% url 'profile' profile_user.username %}" class="btn reset-btn" title="Reset"><img src="{% static 'img/reset.png' %}" alt="Reset" class="icon-img"></a>
                </div>
            </form>

            {% if posts %}
                <ul class="list-group">
                    {% for post in posts %}
                        <a href="{% url 'post_detail' post.pk %}" class="list-group-item list-group-item-action">
                            <div class="d-flex justify-content-between">
                                <p class="mb-1" style="max-width: calc(100% - 120px); font-size: 19px; color: black;">{{ post.title }}</p>
                                <small class="text-muted">{{ post.created_at|date:"M d, Y" }}</small>
                            </div>
                            <small class="text-secondary">
                                {{ post.likes.count }} like{{ post.likes.count|pluralize }} â€¢ 
                                {{ post.comments.count }} comment{{ post.comments.count|pluralize }}
                            </small>
                        </a>
                    {% endfor %}
                </ul>
            {% else %}
                <p class="text-muted">No posts yet.</p>
            {% endif %}

        </div>
    </div>
{% endblock %}
